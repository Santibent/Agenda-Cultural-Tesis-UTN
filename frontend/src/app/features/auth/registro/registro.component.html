<div class="container-fluid min-vh-100 d-flex align-items-center justify-content-center py-5 bg-dark">
  <div class="row w-100 justify-content-center">
    <div class="col-12 col-md-10 col-lg-8 col-xl-6">
      
      <div class="card border-0 shadow-lg">
        <div class="card-body p-4 p-md-5">
          
          <!-- Header -->
          <div class="text-center mb-4">
            <h2 class="fw-bold mb-2">Crear Cuenta</h2>
            <p class="text-muted">√önete a nuestra comunidad cultural</p>
          </div>

          <!-- Mensaje de √©xito -->
          @if (exito()) {
            <div class="alert alert-success d-flex align-items-start mb-4" role="alert">
              <i class="bi bi-check-circle-fill me-3 fs-4 flex-shrink-0"></i>
              <div class="flex-grow-1">
                <h5 class="alert-heading mb-2">¬°Registro Exitoso!</h5>
                <p class="mb-2">
                  üìß Hemos enviado un correo de verificaci√≥n a <strong>{{ registroForm.get('email')?.value }}</strong>
                </p>
                <p class="mb-2">
                  Por favor revisa tu bandeja de entrada y haz clic en el enlace para activar tu cuenta.
                </p>
                <hr class="my-2">
                <p class="mb-0 small">
                  <strong>Nota:</strong> No podr√°s iniciar sesi√≥n hasta que verifiques tu email.
                </p>
              </div>
            </div>
            
            <div class="d-grid gap-2">
              <a routerLink="/auth/login" class="btn btn-primary btn-lg">
                <i class="bi bi-box-arrow-in-right me-2"></i>
                Ir al Login
              </a>
            </div>
          }

          <!-- Formulario -->
          @if (!exito()) {
            <!-- Error general -->
            @if (error()) {
              <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <div>{{ error() }}</div>
              </div>
            }

            <form [formGroup]="registroForm" (ngSubmit)="onSubmit()">
              
              <!-- Nombre -->
              <div class="mb-3">
                <label for="nombre" class="form-label fw-semibold">
                  Nombre Completo <span class="text-danger">*</span>
                </label>
                <input
                  type="text"
                  class="form-control form-control-lg"
                  id="nombre"
                  formControlName="nombre"
                  placeholder="Ingresa tu nombre"
                  [class.is-invalid]="nombre?.invalid && nombre?.touched"
                >
                @if (nombre?.invalid && nombre?.touched) {
                  <div class="invalid-feedback">
                    @if (nombre?.errors?.['required']) {
                      <div>El nombre es obligatorio</div>
                    }
                    @if (nombre?.errors?.['minlength']) {
                      <div>El nombre debe tener al menos 3 caracteres</div>
                    }
                  </div>
                }
              </div>

              <!-- Email -->
              <div class="mb-3">
                <label for="email" class="form-label fw-semibold">
                  Email <span class="text-danger">*</span>
                </label>
                <input
                  type="email"
                  class="form-control form-control-lg"
                  id="email"
                  formControlName="email"
                  placeholder="tu@email.com"
                  [class.is-invalid]="email?.invalid && email?.touched"
                >
                @if (email?.invalid && email?.touched) {
                  <div class="invalid-feedback">
                    @if (email?.errors?.['required']) {
                      <div>El email es obligatorio</div>
                    }
                    @if (email?.errors?.['email']) {
                      <div>Ingresa un email v√°lido</div>
                    }
                  </div>
                }
              </div>

              <!-- Contrase√±a -->
              <div class="mb-3">
                <label for="password" class="form-label fw-semibold">
                  Contrase√±a <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                  <input
                    [type]="mostrarPassword() ? 'text' : 'password'"
                    class="form-control form-control-lg"
                    id="password"
                    formControlName="password"
                    placeholder="M√≠nimo 8 caracteres"
                    [class.is-invalid]="password?.invalid && password?.touched"
                  >
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    (click)="toggleMostrarPassword()"
                    [attr.aria-label]="mostrarPassword() ? 'Ocultar contrase√±a' : 'Mostrar contrase√±a'"
                  >
                    <i [class]="mostrarPassword() ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                  </button>
                </div>
                @if (password?.invalid && password?.touched) {
                  <div class="invalid-feedback d-block">
                    @if (password?.errors?.['required']) {
                      <div>La contrase√±a es obligatoria</div>
                    }
                    @if (password?.errors?.['minlength']) {
                      <div>La contrase√±a debe tener al menos 8 caracteres</div>
                    }
                  </div>
                }
                <small class="text-muted">
                  <i class="bi bi-info-circle me-1"></i>
                  Usa al menos 8 caracteres con una combinaci√≥n de letras y n√∫meros
                </small>
              </div>

              <!-- Confirmar Contrase√±a -->
              <div class="mb-4">
                <label for="confirmarPassword" class="form-label fw-semibold">
                  Confirmar Contrase√±a <span class="text-danger">*</span>
                </label>
                <div class="input-group">
                  <input
                    [type]="mostrarConfirmarPassword() ? 'text' : 'password'"
                    class="form-control form-control-lg"
                    id="confirmarPassword"
                    formControlName="confirmarPassword"
                    placeholder="Repite tu contrase√±a"
                    [class.is-invalid]="confirmarPassword?.invalid && confirmarPassword?.touched"
                  >
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    (click)="toggleMostrarConfirmarPassword()"
                    [attr.aria-label]="mostrarConfirmarPassword() ? 'Ocultar contrase√±a' : 'Mostrar contrase√±a'"
                  >
                    <i [class]="mostrarConfirmarPassword() ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                  </button>
                </div>
                @if (confirmarPassword?.invalid && confirmarPassword?.touched) {
                  <div class="invalid-feedback d-block">
                    @if (confirmarPassword?.errors?.['required']) {
                      <div>Debes confirmar tu contrase√±a</div>
                    }
                  </div>
                }
                @if (registroForm.errors?.['passwordMismatch'] && confirmarPassword?.touched) {
                  <div class="text-danger small mt-1">
                    <i class="bi bi-exclamation-circle me-1"></i>
                    Las contrase√±as no coinciden
                  </div>
                }
              </div>

              <!-- T√©rminos y Condiciones -->
              <div class="form-check mb-4">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="aceptaTerminos"
                  formControlName="aceptaTerminos"
                  [class.is-invalid]="aceptaTerminos?.invalid && aceptaTerminos?.touched"
                >
                <label class="form-check-label" for="aceptaTerminos">
                  Acepto los <a href="#" class="text-decoration-none">t√©rminos y condiciones</a> y la 
                  <a href="#" class="text-decoration-none">pol√≠tica de privacidad</a>
                </label>
                @if (aceptaTerminos?.invalid && aceptaTerminos?.touched) {
                  <div class="invalid-feedback d-block">
                    Debes aceptar los t√©rminos y condiciones
                  </div>
                }
              </div>

              <!-- Bot√≥n Submit -->
              <div class="d-grid mb-4">
                <button
                  type="submit"
                  class="btn btn-primary btn-lg"
                  [disabled]="cargando()"
                >
                  @if (cargando()) {
                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    Registrando...
                  } @else {
                    <i class="bi bi-person-plus me-2"></i>
                    Crear Cuenta
                  }
                </button>
              </div>

              <!-- Separador -->
              <div class="text-center mb-4">
                <div class="position-relative">
                  <hr>
                  <span class="position-absolute top-50 start-50 translate-middle bg-white px-3 text-muted small">
                    o
                  </span>
                </div>
              </div>

              <!-- Link a Login -->
              <div class="text-center">
                <p class="mb-0">
                  ¬øYa tienes una cuenta? 
                  <a routerLink="/auth/login" class="text-decoration-none fw-semibold">
                    Iniciar Sesi√≥n
                  </a>
                </p>
              </div>

            </form>
          }

        </div>
      </div>

      <!-- Link al Home -->
      <div class="text-center mt-4">
        <a routerLink="/" class="text-white text-decoration-none">
          <i class="bi bi-arrow-left me-2"></i>
          Volver al inicio
        </a>
      </div>

    </div>
  </div>
</div>