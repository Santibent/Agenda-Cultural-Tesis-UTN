<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Gesti√≥n de Eventos</h2>
    <button class="btn btn-primary" (click)="mostrarNuevoFormulario()" *ngIf="!mostrarFormulario()">
      Nuevo Evento
    </button>
  </div>

  <!-- Formulario -->
  <div class="card mb-4" *ngIf="mostrarFormulario()">
    <div class="card-header">
      <h5>{{ modoEdicion() ? 'Editar Evento' : 'Nuevo Evento' }}</h5>
    </div>
    <div class="card-body">
      <form [formGroup]="formulario" (ngSubmit)="guardarEvento()">
        <div class="row">
          <!-- Imagen -->
          <div class="col-md-12 mb-3">
            <label class="form-label">Imagen del Evento</label>
            <input
              type="file"
              class="form-control"
              accept="image/*"
              (change)="onImagenSeleccionada($event)"
            />
            <small class="text-muted">Formatos: JPG, PNG, WEBP, GIF. M√°ximo 5MB</small>
            <div *ngIf="imagenPreview()" class="mt-2">
              <img [src]="imagenPreview()" alt="Preview" style="max-width: 200px; max-height: 200px;" class="img-thumbnail">
            </div>
          </div>

          <!-- T√≠tulo -->
          <div class="col-md-12 mb-3">
            <label class="form-label">T√≠tulo *</label>
            <input type="text" class="form-control" formControlName="titulo" />
            <div class="text-danger" *ngIf="formulario.get('titulo')?.invalid && formulario.get('titulo')?.touched">
              Campo obligatorio (3-200 caracteres)
            </div>
          </div>

          <!-- Categor√≠a -->
          <div class="col-md-6 mb-3">
            <label class="form-label">Categor√≠a *</label>
            <select class="form-select" formControlName="categoriaId">
              <option value="">Seleccionar categor√≠a</option>
              <option *ngFor="let cat of categorias()" [value]="cat.id">{{ cat.nombre }}</option>
            </select>
          </div>

          <!-- Fecha Inicio -->
          <div class="col-md-6 mb-3">
            <label class="form-label">Fecha Inicio *</label>
            <input type="date" class="form-control" formControlName="fechaInicio" />
          </div>

          <!-- Ubicaci√≥n -->
          <div class="col-md-12 mb-3">
            <label class="form-label">Ubicaci√≥n *</label>
            <input type="text" class="form-control" formControlName="ubicacion" />
          </div>

          <!-- Descripci√≥n -->
          <div class="col-md-12 mb-3">
            <label class="form-label">Descripci√≥n *</label>
            <textarea class="form-control" rows="4" formControlName="descripcion"></textarea>
          </div>

          <!-- Precio -->
          <div class="col-md-6 mb-3">
            <label class="form-label">Precio</label>
            <input type="number" class="form-control" formControlName="precio" />
          </div>

          <!-- Destacado y Activo -->
          <div class="col-md-6 mb-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" formControlName="destacado" id="destacado">
              <label class="form-check-label" for="destacado">Destacado</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" formControlName="activo" id="activo">
              <label class="form-check-label" for="activo">Activo</label>
            </div>
          </div>
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary" [disabled]="cargando()">
            {{ cargando() ? 'Guardando...' : 'Guardar' }}
          </button>
          <button type="button" class="btn btn-secondary" (click)="cancelarFormulario()">
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Lista de eventos -->
  <div class="card" *ngIf="!mostrarFormulario()">
    <div class="card-body">
      <div *ngIf="cargando()" class="text-center py-5">
        <div class="spinner-border" role="status"></div>
        <p class="mt-2">Cargando eventos...</p>
      </div>

      <div *ngIf="!cargando() && eventos().length === 0" class="text-center py-5">
        <p class="text-muted">No hay eventos registrados</p>
      </div>

      <div class="table-responsive" *ngIf="!cargando() && eventos().length > 0">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Imagen</th>
              <th>T√≠tulo</th>
              <th>Categor√≠a</th>
              <th>Fecha</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let evento of eventos()">
              <td>
                <img [src]="obtenerImagenEvento(evento)" alt="Evento" style="width: 50px; height: 50px; object-fit: cover;" class="rounded">
              </td>
              <td>{{ evento.titulo }}</td>
              <td>{{ obtenerNombreCategoria(evento.categoriaId) }}</td>
              <td>{{ formatearFecha(evento.fechaInicio) }}</td>
              <td>
                <span class="badge" [class.bg-success]="evento.activo" [class.bg-danger]="!evento.activo">
                  {{ evento.activo ? 'Activo' : 'Inactivo' }}
                </span>
                <span class="badge bg-warning" *ngIf="evento.destacado">Destacado</span>
              </td>
              <td>
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-outline-primary" (click)="editarEvento(evento)" title="Editar">
                    Editar
                  </button>
                  <button class="btn btn-outline-warning" (click)="toggleDestacado(evento)" title="Toggle Destacado">
                    ‚≠ê
                  </button>
                  <button class="btn btn-outline-danger" (click)="eliminarEvento(evento)" title="Eliminar">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
