<div class="detalle-evento-page bg-dark-custom min-vh-100">
  <!-- Loader -->
  @if (cargando()) {
    <div class="container py-5">
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="text-muted mt-3">Cargando evento...</p>
      </div>
    </div>
  }

  <!-- Error -->
  @if (error()) {
    <div class="container py-5">
      <div class="alert alert-danger text-center">
        <i class="bi bi-exclamation-triangle-fill fs-1 mb-3"></i>
        <h4>{{ error() }}</h4>
        <button class="btn btn-primary mt-3" (click)="volver()">
          Volver a Eventos
        </button>
      </div>
    </div>
  }

  <!-- Contenido del Evento -->
  @if (!cargando() && !error() && evento()) {
    <!-- Banner del Evento -->
    <section class="evento-banner position-relative">
      @if (evento()!.imagenBanner || evento()!.imagenPrincipal || evento()!.imagenUrl) {
        <div class="banner-image"
             [style.background-image]="'url(' + obtenerImagenEvento(evento()!, evento()!.imagenBanner ? 'imagenBanner' : (evento()!.imagenPrincipal ? 'imagenPrincipal' : 'imagenUrl'), 'grande') + ')'">
          <div class="banner-overlay"></div>
        </div>
      }
      
      <div class="banner-content position-relative">
        <div class="container py-5">
          <!-- Breadcrumb -->
          <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
              <li class="breadcrumb-item">
                <a routerLink="/" class="text-white">Inicio</a>
              </li>
              <li class="breadcrumb-item">
                <a routerLink="/eventos" class="text-white">Eventos</a>
              </li>
              <li class="breadcrumb-item active text-primary-custom">
                {{ evento()!.titulo }}
              </li>
            </ol>
          </nav>

          <div class="row align-items-end">
            <div class="col-lg-8">
              <!-- Categoría -->
              @if (evento()!.categoria) {
                <span
                  class="badge fs-6 mb-3"
                  [style.background-color]="evento()!.categoria!.color"
                >
                  <i class="bi bi-tag me-2"></i>
                  {{ evento()!.categoria!.nombre }}
                </span>
              }

              <!-- Título -->
              <h1 class="display-3 text-white fw-bold mb-3">
                {{ evento()!.titulo }}
              </h1>

              <!-- Badges -->
              <div class="d-flex flex-wrap gap-2 mb-3">
                @if (evento()!.destacado) {
                  <span class="badge bg-primary fs-6">
                    <i class="bi bi-star-fill me-1"></i>
                    Destacado
                  </span>
                }
                @if (evento()!.precio === 0) {
                  <span class="badge bg-success fs-6">
                    <i class="bi bi-gift me-1"></i>
                    Gratis
                  </span>
                }
              </div>

              <!-- Info rápida -->
              <div class="info-rapida d-flex flex-wrap gap-4 text-white">
                <div>
                  <i class="bi bi-calendar3 me-2 text-primary-custom"></i>
                  {{ formatearFecha(evento()!.fechaInicio) }}
                </div>
                @if (evento()!.horaInicio) {
                  <div>
                    <i class="bi bi-clock me-2 text-primary-custom"></i>
                    {{ evento()!.horaInicio }}
                  </div>
                }
                <div>
                  <i class="bi bi-geo-alt me-2 text-primary-custom"></i>
                  {{ evento()!.ubicacion }}
                </div>
              </div>
            </div>

            <div class="col-lg-4 text-lg-end mt-4 mt-lg-0">
              <!-- Botones de acción -->
              <div class="d-flex flex-column gap-2">
                @if (evento()!.linkTickets) {
                  <a 
                    [href]="evento()!.linkTickets" 
                    target="_blank"
                    class="btn btn-primary btn-lg"
                  >
                    <i class="bi bi-ticket-perforated me-2"></i>
                    Comprar Entradas
                  </a>
                }
                <button 
                  class="btn btn-outline-light"
                  (click)="compartir()"
                >
                  <i class="bi bi-share me-2"></i>
                  Compartir
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Contenido Principal -->
    <section class="py-5">
      <div class="container">
        <div class="row">
          <!-- Columna Principal -->
          <div class="col-lg-8">
            <!-- Imagen Principal -->
            @if ((evento()!.imagenPrincipal || evento()!.imagenUrl) && !evento()!.imagenBanner) {
              <div class="mb-4">
                <img
                  [src]="obtenerImagenEvento(evento()!, evento()!.imagenPrincipal ? 'imagenPrincipal' : 'imagenUrl', 'grande')"
                  [alt]="evento()!.titulo"
                  class="img-fluid rounded w-100"
                  style="max-height: 500px; object-fit: cover;"
                />
              </div>
            }

            <!-- Descripción -->
            <div class="card bg-dark-secondary border-0 mb-4">
              <div class="card-body p-4">
                <h3 class="text-white mb-3">
                  <i class="bi bi-info-circle me-2 text-primary-custom"></i>
                  Descripción
                </h3>
                <div class="text-muted" style="white-space: pre-line; line-height: 1.8;">
                  {{ evento()!.descripcion }}
                </div>
              </div>
            </div>

            <!-- Ubicación -->
            <div class="card bg-dark-secondary border-0 mb-4">
              <div class="card-body p-4">
                <h3 class="text-white mb-3">
                  <i class="bi bi-map me-2 text-primary-custom"></i>
                  Ubicación
                </h3>
                <div class="text-muted">
                  <p class="mb-2">
                    <strong>{{ evento()!.ubicacion }}</strong>
                  </p>
                  @if (evento()!.direccion) {
                    <p class="mb-2">
                      <i class="bi bi-pin-map me-2"></i>
                      {{ evento()!.direccion }}
                    </p>
                  }
                  <p class="mb-0">
                    <i class="bi bi-geo me-2"></i>
                    {{ evento()!.ciudad }}, {{ evento()!.provincia }}, {{ evento()!.pais }}
                  </p>
                </div>

                @if (evento()!.latitud && evento()!.longitud) {
                  <div class="mt-3">
                    <a 
                      [href]="'https://www.google.com/maps?q=' + evento()!.latitud + ',' + evento()!.longitud"
                      target="_blank"
                      class="btn btn-outline-light btn-sm"
                    >
                      <i class="bi bi-map me-2"></i>
                      Ver en Google Maps
                    </a>
                  </div>
                }
              </div>
            </div>

            <!-- Organizador -->
            @if (evento()!.organizador) {
              <div class="card bg-dark-secondary border-0">
                <div class="card-body p-4">
                  <h3 class="text-white mb-3">
                    <i class="bi bi-person-badge me-2 text-primary-custom"></i>
                    Organizador
                  </h3>
                  <p class="text-muted mb-0">{{ evento()!.organizador }}</p>
                </div>
              </div>
            }
          </div>

          <!-- Sidebar -->
          <div class="col-lg-4">
            <!-- Card de Información -->
            <div class="card bg-dark-secondary border-0 sticky-top" style="top: 100px;">
              <div class="card-body p-4">
                <h4 class="text-white mb-4">Información del Evento</h4>

                <!-- Fecha y Hora -->
                <div class="info-item mb-3 pb-3 border-bottom border-secondary">
                  <div class="d-flex align-items-start">
                    <i class="bi bi-calendar-event fs-4 text-primary-custom me-3"></i>
                    <div>
                      <small class="text-muted d-block">Fecha de inicio</small>
                      <strong class="text-white">{{ formatearFecha(evento()!.fechaInicio) }}</strong>
                      @if (evento()!.horaInicio) {
                        <div class="text-muted small mt-1">{{ evento()!.horaInicio }}</div>
                      }
                    </div>
                  </div>
                </div>

                @if (evento()!.fechaFin) {
                  <div class="info-item mb-3 pb-3 border-bottom border-secondary">
                    <div class="d-flex align-items-start">
                      <i class="bi bi-calendar-check fs-4 text-primary-custom me-3"></i>
                      <div>
                        <small class="text-muted d-block">Fecha de fin</small>
                        <strong class="text-white">{{ formatearFecha(evento()!.fechaFin) }}</strong>
                        @if (evento()!.horaFin) {
                          <div class="text-muted small mt-1">{{ evento()!.horaFin }}</div>
                        }
                      </div>
                    </div>
                  </div>
                }

                <!-- Precio -->
                <div class="info-item mb-3 pb-3 border-bottom border-secondary">
                  <div class="d-flex align-items-start">
                    <i class="bi bi-currency-dollar fs-4 text-primary-custom me-3"></i>
                    <div>
                      <small class="text-muted d-block">Precio</small>
                      @if (evento()!.precio === 0) {
                        <strong class="text-success">GRATIS</strong>
                      } @else {
                        <strong class="text-white">
                          {{ evento()!.moneda }} ${{ evento()!.precio }}
                        </strong>
                      }
                    </div>
                  </div>
                </div>

                <!-- Capacidad -->
                @if (evento()!.capacidad) {
                  <div class="info-item mb-3 pb-3 border-bottom border-secondary">
                    <div class="d-flex align-items-start">
                      <i class="bi bi-people fs-4 text-primary-custom me-3"></i>
                      <div>
                        <small class="text-muted d-block">Capacidad</small>
                        <strong class="text-white">{{ evento()!.capacidad }} personas</strong>
                      </div>
                    </div>
                  </div>
                }

                <!-- Contacto -->
                @if (evento()!.contactoEmail || evento()!.contactoTelefono) {
                  <div class="info-item mb-3">
                    <h5 class="text-white mb-3">Contacto</h5>
                    @if (evento()!.contactoEmail) {
                      <div class="mb-2">
                        <a 
                          [href]="'mailto:' + evento()!.contactoEmail"
                          class="text-primary-custom text-decoration-none"
                        >
                          <i class="bi bi-envelope me-2"></i>
                          {{ evento()!.contactoEmail }}
                        </a>
                      </div>
                    }
                    @if (evento()!.contactoTelefono) {
                      <div>
                        <a 
                          [href]="'tel:' + evento()!.contactoTelefono"
                          class="text-primary-custom text-decoration-none"
                        >
                          <i class="bi bi-telephone me-2"></i>
                          {{ evento()!.contactoTelefono }}
                        </a>
                      </div>
                    }
                  </div>
                }

                <!-- Botones -->
                <div class="d-grid gap-2 mt-4">
                  @if (evento()!.linkTickets) {
                    <a 
                      [href]="evento()!.linkTickets" 
                      target="_blank"
                      class="btn btn-primary"
                    >
                      <i class="bi bi-ticket-perforated me-2"></i>
                      Comprar Entradas
                    </a>
                  }
                  @if (evento()!.linkExterno) {
                    <a 
                      [href]="evento()!.linkExterno" 
                      target="_blank"
                      class="btn btn-outline-light"
                    >
                      <i class="bi bi-box-arrow-up-right me-2"></i>
                      Más Información
                    </a>
                  }
                  <button 
                    class="btn btn-outline-light"
                    (click)="compartir()"
                  >
                    <i class="bi bi-share me-2"></i>
                    Compartir Evento
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Botón Volver -->
    <section class="py-4 bg-dark-secondary">
      <div class="container">
        <button class="btn btn-outline-light" (click)="volver()">
          <i class="bi bi-arrow-left me-2"></i>
          Volver a Eventos
        </button>
      </div>
    </section>
  }
</div>